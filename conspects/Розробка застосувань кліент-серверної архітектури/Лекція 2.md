---
Tags: 
 - college
 - KCA/Lection
---
# Базові поняття про сокети Windows
## Загальні поняття про сокет
В процесі мережевого з'єднання два процеси обмінюються даними. 

**`Сокет`** (socket - заглиблення) — назва програмного інтерфейсу для забезпечення обміну даними між процесами. Процеси при такому обміні можуть виконуватися як на одній ЕОМ, так і на різних ЕОМ, пов'язаних між собою мережею.

`Сокет` - абстрактний об'єкт, що представляє кінцеву точку з'єднання.

Кожен сокет, що використовується, має `тип` і асоційований з ним `процес`. 

Слід розрізняти `клієнтські` i `серверні` сокети.
`Клієнтські` сокети грубо можна порівняти з кінцевими апаратами телефонної мережі, а серверні - з комутаторами. 

Клієнтський додаток (наприклад, браузер) використовує лише `клієнтські` сокети.
Серверний (наприклад, вебсервер, якому браузер посилає запити) - як `клієнтські`, так і `серверні` сокети.

Сокети існують у середині комунікаційних `доменів`. 

**`Домени`** - це абстракції, які мають конкретну `структуру адресації` і `безліч протоколів`, які визначають різні типи сокетів у середині домена. 

Приклади комунікаційних доменів: `UNIX` домен, `Internet` домен, і т.д.

У `Internet` домені, сокет – це комбінація **IP** адреси і номера **порту**, яка однозначно визначає окремий мережевий процес у всій глобальній мережі Internet. 

## **Типи сокетів**
Типи `сокетів` визначають особливості зв'язку додатків. 

**Процеси взаємодіють тільки через сокети одного і того ж типу.**

Основні типи `сокетів`:
-   `потоковий сокет` – забезпечує двосторонній, послідовний, надійний, і недубльовані потік даних без певних кордонів. 
	Тип сокета – **SOCK_STREAM**, в домені Інтернету він використовує протокол **TCP**.
-   `датаграмний сокет` – підтримує двосторонній потік повідомлень. Додаток, що використовує такі сокети, може отримувати повідомлення в порядку, відмінному від послідовності, в якій ці повідомлення надсилалися. 
	Тип сокета – **SOCK_DGRAM**, в домені Інтернету він використовує протокол **UDP**.
-   `сокет послідовних пакетів` – забезпечує двосторонній, послідовний, надійний обмін датаграму фіксованою максимальної довжини. 
	Тип сокета – **SOCK_SEQPACKET**. Для цього типу сокета **не існує спеціального протоколу**
-  `простий сокет` - забезпечує доступ до основних протоколах зв'язку.

Всі `сокети` зазвичай орієнтовані на застосування `датаграм`, але їх точні характеристики залежать від інтерфейсу, забезпечуваного протоколом. 

Обмін між сокетами відбувається за такою схемою рисунок
![[socets.png]]
## Сокети Windows
Можливість взаємодії з іншими системами забезпечується в `Windows` підтримкою сокетів `Windows Sockets` – сумісного і майже точного аналога сокетів Берклі (`Berkeley Sockets`), що де-факто грають роль промислового стандарту.

Оскільки інтерфейс `Winsock` повинен відповідати промисловому стандарту, прийняті у ньому угоди про правила привласнення імен і стилі програмування дещо відрізняються від тих, з якими ми звикли стикатися в процесі роботи з функціями Windows. 

Слід зазначити, що `Winsock API` не є частиною `Win32/64`. Крім того, `Winsock` надає додаткові функції що не відповідають стандартам; ці функції використовуються лише у разі крайньої необхідності.

До переваг `Winsock` можна віднести наступне:
-   Перенесення вже існуючого коду, написаного для `Berkeley Sockets API`, здійснюється безпосередньо.
-   Системи `Windows` легко вбудовуються в мережі, що використовують, як версію `Ipv4` протоколу `TCP`/IP, `так` і версію `IPv6`, що поступово розповсюджується.
-   Сокети можуть використовуватися спільно з введенням/виведенням `Windows`, що перекривається, що, окрім всього іншого, забезпечує можливість масштабування серверів при збільшенні кількості активних клієнтів.
-   Сокети можна розглядати, як дескриптори (типу `HANDLE`) файлів при використанні функцій `ReadFile` і `WriteFile`, та з деякими обмеженнями, при використанні інших функцій. Ця можливість виявляється зручною в тих випадках, коли потрібне використання асинхронного введення/виведення і портів завершення введення/виведення.
-   Існують також додаткові, непереносимі розширення.

## Функції сокетів
`API Winsock` містить набір функцій. 

Специфікація `Winsock` розбиває їх на три групи:
-   функції сокетів в стилі `Берклі`, включені в `Winsock API`;
-   функції для роботи з базами даних, що дозволяють програмам отримувати інформацію про імена доменів, протоколи і т.д.
-   функції, що розподіляють набір функцій інтерфейсу сокетів Берклі.

Крім того, всі функції можна розділити на дві великі групи: блокуючі і не блокуючі.

### Блокуючі функції
`Блокуюча` функція примушує програму, що викликала її, чекати закінчення мережевої операції введення/виведення. 

Як приклад приведемо декілька функцій цієї групи:
- `аccept` – підтверджує запит на встановлення з'єднання. Утворює новий сокет і сполучає його з видаленим комп'ютером, що запрошує з'єднання. Початковий сокет повертається в стан прийому вхідних запитів.
- `closesocket` – закриває одну сторону в з'єднанні сокетів;
- `connect` – встановлює з'єднання на вказаному сокеті;
- `recv` – приймає дані із сполученого сокета;
- `send` – передає дані через сполучений сокет;
- `sendto` – передає дані через сполучений або не сполучений сокет; 


### Не блокуючі функції
Не блокуюча функція не примушує програму, що викликала її, чекати закінчення мережевої операції введення/виведення. Вони перетворюють інформацію або мають справу з локальним сокетом. Як приклад приведемо декілька функцій цієї групи:

- `bind` – привласнює ім'я неініціалізованому сокету;
- `getsockname` – повертає ім'я вказаного локального сокета;
- `getsockopt` – повертає опції вказаного сокета;
- `htonl` – перетворює порядок байтів в 32-розрядному числі з машинно-незалежного в мережевий;
- `htons` – перетворює порядок байтів в 16-розрядному числі з машинно-незалежного в мережевий;
- `inet_addr` – перетворює рядок з IP-адресою у форматі десяткового з крапкою в 32-розрядне число в мережевому форматі;
- `inet_ntoa` – перетворює IP-адрес у формат десяткового з крапкою;
- `listen` – встановлює вказаний сокет в стан прослуховування запитів на вхідне з'єднання. Сама функція не проводить мережевих операцій введення/виведення;
- `ntohl` – перетворює порядок байтів 32-розрядного числа з мережевого в машинно-залежний;
- `setsockopt` – встановлює опції сокета;
- `shutdown` – закриває одну сторону видаленого з'єднання;
- `socket` – утворює точку мережевого з'єднання і повертає дескриптор сокета.